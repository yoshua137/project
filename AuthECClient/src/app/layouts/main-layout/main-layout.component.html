<div class="min-h-screen bg-blue-100 flex flex-col">
  <!-- Banner de estado del backend -->
  <app-backend-status-banner></app-backend-status-banner>
  
  <button (click)="showHeaderMenu = !showHeaderMenu"
    class="fixed top-4 left-4 z-50 bg-blue-ucb text-white rounded-full shadow-lg p-2 hover:bg-blue-800 transition-all flex items-center gap-2"
    title="{{ showHeaderMenu ? 'Ocultar menú' : 'Mostrar menú' }}">
    <ng-container *ngIf="showHeaderMenu; else showMenuIcon">
      <!-- Icono menu_open de Google Fonts Material Symbols -->
      <span class="material-symbols-outlined" style="font-size: 24px;">menu_open</span>
    </ng-container>
    <ng-template #showMenuIcon>
      <!-- Icono de hamburguesa -->
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
      <span class="hidden sm:inline text-xs font-semibold">Mostrar menú</span>
    </ng-template>
  </button>

  <div *ngIf="showHeaderMenu" class="w-full">
    <!-- Header sticky y animado -->
    <header *ngIf="showHeaderBar" @slideDownUp
      class="sticky top-0 z-30 flex items-center justify-between bg-crema px-8 py-1 shadow rounded-b-none rounded-t-2xl transition-all duration-300">
      <div class="flex items-center gap-4">
        <a routerLink="/dashboard">
          <img src="assets/logo-main.png" alt="Logo" class="h-20 w-auto pl-6" />
        </a>
      </div>
      <div class="flex items-center gap-4">
        <form class="flex" role="search">
          <input class="form-input px-2 py-1 rounded-l border border-gray-300 focus:outline-none" type="search"
            placeholder="¿Qué estás buscando?" aria-label="Search">
          <button class="bg-blue-ucb text-white px-4 py-1 rounded-r font-semibold hover:bg-blue-800 transition"
            type="submit">Buscar</button>
        </form>
        <!-- Componente de notificaciones -->
        <app-notification-bell></app-notification-bell>
        <div class="relative" (click)="$event.stopPropagation()">
          <button
            class="profile-menu-trigger p-2 rounded-full border-2 border-transparent hover:border-blue-ucb hover:bg-white transition duration-200 flex items-center justify-center"
            title="Menú de perfil" aria-label="Menú de perfil"
            (click)="toggleProfileMenu($event)">
            <ng-container *ngIf="profilePhotoUrl; else defaultProfileIcon">
              <img [src]="profilePhotoUrl" alt="Foto de perfil" class="w-10 h-10 rounded-full object-cover border-2 border-blue-ucb">
            </ng-container>
            <ng-template #defaultProfileIcon>
              <div class="w-10 h-10 rounded-full bg-blue-ucb text-white font-semibold border-2 border-blue-ucb flex items-center justify-center">
                {{ profileInitials }}
              </div>
            </ng-template>
          </button>
          <div *ngIf="showProfileMenu"
            class="profile-dropdown absolute right-0 mt-3 w-60 bg-white rounded-2xl shadow-2xl border border-blue-50 z-50 overflow-hidden">
            <button (click)="navigateToProfile()" class="profile-menu-item text-left">
              <span class="menu-title">Ver perfil</span>
              <span class="menu-subtitle">Consulta tu información</span>
            </button>
            <button (click)="logoutFromMenu()" class="profile-menu-item text-left logout">
              <span class="menu-title">Cerrar sesión</span>
              <span class="menu-subtitle">Salir de tu cuenta</span>
            </button>
          </div>
        </div>
      </div>
    </header>
  </div>
  <!-- Nav azul sticky SIEMPRE visible mientras showHeaderMenu sea true -->
  <nav *ngIf="showHeaderMenu"
    class="sticky top-0 z-20 bg-blue-ucb text-white px-8 py-2 shadow rounded-b-2xl rounded-t-none transition-all duration-300">
    <ul class="flex flex-row gap-2 w-full justify-start">
      <li class="nav-item" [appHideIfClaimsNotMet]="claimReq.organizationOnly">
        <a class="nav-link text-white hover:bg-blue-800 rounded px-4 py-2 transition border-2 border-transparent router-link-active:bg-white/10 router-link-active:border-yellow-ucb router-link-active:text-yellow-ucb"
          routerLink="/agreement-requests" routerLinkActive="!bg-white/10 !border-yellow-ucb !text-yellow-ucb"
          [routerLinkActiveOptions]="{ exact: true }">Solicitar Convenio</a>
      </li>
      <li class="nav-item" [appHideIfClaimsNotMet]="claimReq.adminInvitationManager">
        <a class="nav-link text-white hover:bg-blue-800 rounded px-4 py-2 transition border-2 border-transparent router-link-active:bg-white/10 router-link-active:border-yellow-ucb router-link-active:text-yellow-ucb"
          routerLink="/registration-invitations" routerLinkActive="!bg-white/10 !border-yellow-ucb !text-yellow-ucb"
          [routerLinkActiveOptions]="{ exact: true }">Invitaciones de Registro</a>
      </li>
      <li class="nav-item" [appHideIfClaimsNotMet]="claimReq.directorAgreementReviewer">
        <a class="nav-link text-white hover:bg-blue-800 rounded px-4 py-2 transition border-2 border-transparent router-link-active:bg-white/10 router-link-active:border-yellow-ucb router-link-active:text-yellow-ucb"
          routerLink="/agreement-review" routerLinkActive="!bg-white/10 !border-yellow-ucb !text-yellow-ucb"
          [routerLinkActiveOptions]="{ exact: true }">Revisar Convenios</a>
      </li>
      <li class="nav-item" [appHideIfClaimsNotMet]="claimReq.organizationAgreementList">
        <a class="nav-link text-white hover:bg-blue-800 rounded px-4 py-2 transition border-2 border-transparent router-link-active:bg-white/10 router-link-active:border-yellow-ucb router-link-active:text-yellow-ucb"
          routerLink="/mis-convenios" routerLinkActive="!bg-white/10 !border-yellow-ucb !text-yellow-ucb"
          [routerLinkActiveOptions]="{ exact: true }">Mis convenios</a>
      </li>
      <li class="nav-item" [appHideIfClaimsNotMet]="claimReq.organizationInternshipOffer">
        <a class="nav-link text-white hover:bg-blue-800 rounded px-4 py-2 transition border-2 border-transparent router-link-active:bg-white/10 router-link-active:border-yellow-ucb router-link-active:text-yellow-ucb"
          routerLink="/publicar-pasantia" routerLinkActive="!bg-white/10 !border-yellow-ucb !text-yellow-ucb"
          [routerLinkActiveOptions]="{ exact: true }">Publicar Pasantía</a>
      </li>
      <li class="nav-item" [appHideIfClaimsNotMet]="claimReq.organizationInternshipOffer">
        <a class="nav-link text-white hover:bg-blue-800 rounded px-4 py-2 transition border-2 border-transparent router-link-active:bg-white/10 router-link-active:border-yellow-ucb router-link-active:text-yellow-ucb"
          routerLink="/mis-ofertas-pasantia" routerLinkActive="!bg-white/10 !border-yellow-ucb !text-yellow-ucb"
          [routerLinkActiveOptions]="{ exact: true }">Mis Ofertas de Pasantía</a>
      </li>
      <li class="nav-item" [appHideIfClaimsNotMet]="claimReq.studentInternshipOffers">
        <a class="nav-link text-white hover:bg-blue-800 rounded px-4 py-2 transition border-2 border-transparent router-link-active:bg-white/10 router-link-active:border-yellow-ucb router-link-active:text-yellow-ucb"
          routerLink="/ver-ofertas-pasantia" routerLinkActive="!bg-white/10 !border-yellow-ucb !text-yellow-ucb"
          [routerLinkActiveOptions]="{ exact: true }">Ver Ofertas de Pasantía</a>
      </li>
      <li class="nav-item" [appHideIfClaimsNotMet]="claimReq.studentInternshipOffers">
        <a class="nav-link text-white hover:bg-blue-800 rounded px-4 py-2 transition border-2 border-transparent router-link-active:bg-white/10 router-link-active:border-yellow-ucb router-link-active:text-yellow-ucb"
          routerLink="/mis-aplicaciones" routerLinkActive="!bg-white/10 !border-yellow-ucb !text-yellow-ucb"
          [routerLinkActiveOptions]="{ exact: true }">Mis Pasantías</a>
      </li>
    </ul>
  </nav>
  <!-- Contenido principal -->
  <main
    class="flex-1 flex flex-col items-center py-8 px-4 bg-crema rounded-3xl m-8 shadow-xl overflow-auto custom-scrollbar">
    <router-outlet />
  </main>
</div>
<style>
  .custom-scrollbar::-webkit-scrollbar {
    width: 8px;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: #003366;
    border-radius: 8px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: #ffe066;
    border-radius: 8px;
  }

  /* Firefox */
  .custom-scrollbar {
    scrollbar-width: thin;
    scrollbar-color: #003366 #ffe066;
  }

  .profile-dropdown {
    min-width: 14rem;
  }

  .profile-menu-item {
    width: 100%;
    padding: 0.85rem 1.5rem;
    border: none;
    background: #fff;
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
    color: #0f172a;
    cursor: pointer;
    transition: background 0.15s ease;
  }

  .profile-menu-item:hover {
    background: #eef5ff;
  }

  .profile-menu-item.logout {
    border-top: 1px solid #f1f5f9;
  }

  .profile-menu-item.logout .menu-title {
    color: #b91c1c;
  }

  .menu-title {
    font-weight: 600;
    font-size: 0.95rem;
  }

  .menu-subtitle {
    font-size: 0.78rem;
    color: #64748b;
  }
</style>