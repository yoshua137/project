<div class="min-h-screen bg-blue-100 flex flex-col">
  <!-- Banner de estado del backend -->
  <app-backend-status-banner></app-backend-status-banner>
  
  <button (click)="showHeaderMenu = !showHeaderMenu"
    class="fixed top-4 left-4 z-50 bg-blue-ucb text-white rounded-full shadow-lg p-2 hover:bg-blue-800 transition-all flex items-center gap-2"
    title="{{ showHeaderMenu ? 'Ocultar menú' : 'Mostrar menú' }}">
    <ng-container *ngIf="showHeaderMenu; else showMenuIcon">
      <!-- Icono menu_open de Google Fonts Material Symbols -->
      <span class="material-symbols-outlined" style="font-size: 24px;">menu_open</span>
    </ng-container>
    <ng-template #showMenuIcon>
      <!-- Icono de hamburguesa -->
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
      <span class="hidden sm:inline text-xs font-semibold">Mostrar menú</span>
    </ng-template>
  </button>

  <div *ngIf="showHeaderMenu" class="w-full">
    <!-- Header sticky y animado -->
    <header *ngIf="showHeaderBar" @slideDownUp
      class="sticky top-0 z-30 flex items-center justify-between bg-crema px-8 py-1 shadow rounded-b-none rounded-t-2xl transition-all duration-300">
      <div class="flex items-center gap-4">
        <a routerLink="/dashboard">
          <img src="assets/logo-main.png" alt="Logo" class="h-20 w-auto pl-6" />
        </a>
      </div>
      <div class="flex items-center gap-4">
        <div class="relative" (click)="$event.stopPropagation()">
          <button
            class="help-trigger focus:outline-none"
            title="Centro de ayuda"
            aria-label="Centro de ayuda"
            (click)="toggleHelpMenu($event)">
            <div class="help-icon-circle">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-9 w-9 text-slate-800" viewBox="0 0 24 24">
                <path fill="currentColor" d="M12 2a10 10 0 100 20 10 10 0 000-20Zm-.02 3.5a3 3 0 012.94 2.52c.2 1.18-.25 2.22-1.21 2.9-.74.53-1.21.87-1.21 1.88v.2h-2v-.3c0-1.44.7-2.1 1.42-2.62.6-.43.84-.74.76-1.2A1.05 1.05 0 0011.98 7a1.04 1.04 0 00-1.06 1h-2.06a3.12 3.12 0 013.12-2.5Zm.02 9.5a1.2 1.2 0 11-1.2 1.2 1.2 1.2 0 011.2-1.2Z"/>
              </svg>
            </div>
          </button>
          <div *ngIf="showHelpMenu"
            class="absolute right-0 mt-3 w-72 bg-white rounded-2xl shadow-2xl border border-blue-50 z-50 overflow-hidden">
            <div class="px-4 py-3 border-b border-blue-50 bg-blue-50">
              <p class="text-sm font-semibold text-blue-900">Centro de ayuda</p>
              <p class="text-xs text-blue-700">Encuentra recursos y soporte.</p>
            </div>
            <div class="py-2">
              <button
                class="w-full text-left px-5 py-3 text-sm text-slate-700 hover:bg-blue-50 flex items-center gap-2"
                (click)="openHelpGuide()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 6l-2 4h4l-2 4m-6-2V8.5C6 7.12 7.12 6 8.5 6H12m0 12h3.5c1.38 0 2.5-1.12 2.5-2.5V10m-5 8H8.5A2.5 2.5 0 016 15.5V14" />
                </svg>
                Ver guías rápidas
              </button>
              <button
                class="w-full text-left px-5 py-3 text-sm text-slate-700 hover:bg-blue-50 flex items-center gap-2"
                (click)="contactSupport()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M18 10a6 6 0 00-12 0v3a2 2 0 002 2h1v3l3-3h3a2 2 0 002-2v-3z" />
                </svg>
                Contactar soporte
              </button>
            </div>
          </div>
        </div>
        <!-- Componente de notificaciones -->
        <app-notification-bell (dropdownChange)="onNotificationsToggle($event)"></app-notification-bell>
        <div class="relative" (click)="$event.stopPropagation()">
              <button
                class="profile-menu-trigger p-2 rounded-full hover:bg-white transition duration-200 transition-transform flex items-center justify-center hover:scale-110 focus:outline-none"
            title="Menú de perfil" aria-label="Menú de perfil"
            (click)="toggleProfileMenu($event)">
            <ng-container *ngIf="profilePhotoUrl; else defaultProfileIcon">
                  <img [src]="profilePhotoUrl" alt="Foto de perfil" class="w-10 h-10 rounded-full object-cover">
            </ng-container>
            <ng-template #defaultProfileIcon>
                  <div class="w-10 h-10 rounded-full bg-blue-ucb text-white font-semibold flex items-center justify-center">
                {{ profileInitials }}
              </div>
            </ng-template>
          </button>
          <div *ngIf="showProfileMenu"
            class="profile-dropdown absolute right-0 mt-3 w-60 bg-white rounded-2xl shadow-2xl border border-blue-50 z-50 overflow-hidden">
            <button (click)="navigateToProfile()" class="profile-menu-item text-left">
              <span class="menu-title">Ver perfil</span>
              <span class="menu-subtitle">Consulta tu información</span>
            </button>
            <button (click)="logoutFromMenu()" class="profile-menu-item text-left logout">
              <span class="menu-title">Cerrar sesión</span>
              <span class="menu-subtitle">Salir de tu cuenta</span>
            </button>
          </div>
        </div>
      </div>
    </header>
  </div>
  <!-- Nav azul sticky SIEMPRE visible mientras showHeaderMenu sea true -->
  <nav *ngIf="showHeaderMenu"
    class="sticky top-0 z-20 bg-blue-ucb text-white px-6 py-1 shadow transition-all duration-300">
    <ul class="flex flex-row gap-4 w-full justify-start">
      <li class="nav-item" [appHideIfClaimsNotMet]="claimReq.organizationOnly">
        <a class="nav-link text-white px-3 py-1 transition relative"
          routerLink="/agreement-requests" routerLinkActive="active-nav-link"
          [routerLinkActiveOptions]="{ exact: true }">Solicitar Convenio</a>
      </li>
      <li class="nav-item" [appHideIfClaimsNotMet]="claimReq.adminInvitationManager">
        <a class="nav-link text-white px-3 py-1 transition relative"
          routerLink="/registration-invitations" routerLinkActive="active-nav-link"
          [routerLinkActiveOptions]="{ exact: true }">Invitaciones de Registro</a>
      </li>
      <li class="nav-item" [appHideIfClaimsNotMet]="claimReq.directorAgreementReviewer">
        <a class="nav-link text-white px-3 py-1 transition relative"
          routerLink="/agreement-review" routerLinkActive="active-nav-link"
          [routerLinkActiveOptions]="{ exact: true }">Revisar Convenios</a>
      </li>
      <li class="nav-item" [appHideIfClaimsNotMet]="claimReq.directorAgreementReviewer">
        <a class="nav-link text-white px-3 py-1 transition relative"
          routerLink="/cartas-aceptacion" routerLinkActive="active-nav-link"
          [routerLinkActiveOptions]="{ exact: true }">Cartas de Aceptación</a>
      </li>
      <li class="nav-item" [appHideIfClaimsNotMet]="claimReq.organizationAgreementList">
        <a class="nav-link text-white px-3 py-1 transition relative"
          routerLink="/mis-convenios" routerLinkActive="active-nav-link"
          [routerLinkActiveOptions]="{ exact: true }">Mis convenios</a>
      </li>
      <li class="nav-item" [appHideIfClaimsNotMet]="claimReq.organizationInternshipOffer">
        <a class="nav-link text-white px-3 py-1 transition relative"
          routerLink="/publicar-pasantia" routerLinkActive="active-nav-link"
          [routerLinkActiveOptions]="{ exact: true }">Publicar Pasantía</a>
      </li>
      <li class="nav-item" [appHideIfClaimsNotMet]="claimReq.organizationInternshipOffer">
        <a class="nav-link text-white px-3 py-1 transition relative"
          routerLink="/mis-ofertas-pasantia" routerLinkActive="active-nav-link"
          [routerLinkActiveOptions]="{ exact: true }">Mis Ofertas de Pasantía</a>
      </li>
      <li class="nav-item" [appHideIfClaimsNotMet]="claimReq.studentInternshipOffers">
        <a class="nav-link text-white px-3 py-1 transition relative"
          routerLink="/ver-ofertas-pasantia" routerLinkActive="active-nav-link"
          [routerLinkActiveOptions]="{ exact: true }">Ver Ofertas de Pasantía</a>
      </li>
      <li class="nav-item" [appHideIfClaimsNotMet]="claimReq.studentInternshipOffers">
        <a class="nav-link text-white px-3 py-1 transition relative"
          routerLink="/mis-aplicaciones" routerLinkActive="active-nav-link"
          [routerLinkActiveOptions]="{ exact: true }">Mis Pasantías</a>
      </li>
      <li class="nav-item" [appHideIfClaimsNotMet]="claimReq.teacherOnly">
        <a class="nav-link text-white px-3 py-1 transition relative"
          routerLink="/cursos" routerLinkActive="active-nav-link"
          [routerLinkActiveOptions]="{ exact: true }">Cursos</a>
      </li>
    </ul>
  </nav>
  <!-- Contenido principal -->
  <main
    class="flex-1 flex flex-col items-center py-8 px-4 bg-crema rounded-3xl m-8 shadow-xl overflow-auto custom-scrollbar">
    <router-outlet />
  </main>
</div>
<style>
  .custom-scrollbar::-webkit-scrollbar {
    width: 8px;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: #003366;
    border-radius: 8px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: #ffe066;
    border-radius: 8px;
  }

  /* Firefox */
  .custom-scrollbar {
    scrollbar-width: thin;
    scrollbar-color: #003366 #ffe066;
  }

  .profile-dropdown {
    min-width: 14rem;
  }

  .profile-menu-item {
    width: 100%;
    padding: 0.85rem 1.5rem;
    border: none;
    background: #fff;
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
    color: #0f172a;
    cursor: pointer;
    transition: background 0.15s ease;
  }

  .profile-menu-item:hover {
    background: #eef5ff;
  }

  .profile-menu-item.logout {
    border-top: 1px solid #f1f5f9;
  }

  .profile-menu-item.logout .menu-title {
    color: #b91c1c;
  }

  .menu-title {
    font-weight: 600;
    font-size: 0.95rem;
  }

  .menu-subtitle {
    font-size: 0.78rem;
    color: #64748b;
  }

  .help-trigger {
    padding: 4px;
    border-radius: 9999px;
    background: transparent;
    border: none;
  }

  .help-icon-circle {
    border-radius: 9999px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    transition: transform 0.2s ease;
  }

  .help-trigger:hover .help-icon-circle {
    transform: scale(1.1);
  }

  .nav-link {
    position: relative;
    font-weight: 500;
    letter-spacing: 0.02em;
  }

  .nav-link::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    bottom: -4px;
    height: 2px;
    background: transparent;
    transition: background 0.2s ease;
  }

  .nav-link.active-nav-link::after {
    background: #ffffff;
  }

  .nav-link.active-nav-link {
    color: #ffffff;
  }
</style>